---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Hero from '../components/Hero.astro';
import Products from '../components/Products.astro';
import FeaturedProducts from '../components/FeaturedProducts';
import Features from '../components/Features.astro';
import BrandsSlider from '../components/BrandsSlider';
import ContactForm from '../components/ContactForm';
import Footer from '../components/Footer.astro';

// Strapi configuration
const STRAPI_URL = import.meta.env.PUBLIC_STRAPI_URL || 'http://localhost:1337';

// Fetch featured products from Strapi
let featuredProducts = [];
try {
  console.log('Fetching from:', `${STRAPI_URL}/api/products?filters[featured][$eq]=true&populate=*`);
  const response = await fetch(`${STRAPI_URL}/api/products?filters[featured][$eq]=true&populate=*`);
  console.log('Response status:', response.status);
  const data = await response.json();
  console.log('Products data:', JSON.stringify(data, null, 2));
  featuredProducts = data.data.map((item: any) => ({
    id: item.id,
    name: item.name,
    model: item.model,
    description: item.description,
    image: item.image,
    capacity: item.capacity,
    features: item.features
  }));
  console.log('Mapped products:', featuredProducts.length);
} catch (error) {
  console.error('Error fetching products from Strapi:', error);
}
---

<Layout title="FORZA Power Technologies - Soluciones de EnergÃ­a Inteligentes">
  <Navbar />
  <Hero />
  <Products />
  <FeaturedProducts products={featuredProducts} strapiUrl={STRAPI_URL} client:visible />
  <Features />
  <BrandsSlider client:visible />
  <ContactForm client:visible />
  <Footer />
</Layout>
